---
title: "è„†å¼±æ€§ã‹ã‚‰å­¦ã¶Rubyå‡¦ç†ç³»(CVE-2022-28739)"
emoji: "â›³"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["ruby", "c"]
published: false
---

# è„†å¼±æ€§ã‹ã‚‰å­¦ã¶Rubyå‡¦ç†ç³»(CVE-2022-28739)
æœ€è¿‘ä»•äº‹ã§Rubyã‚’ä½¿ã†ã‚ˆã†ã«ãªã£ãŸã®ã ãŒã€ã“ã‚Œã¾ã§æ¥­å‹™ã§ä½¿ã£ãŸã“ã¨ã®ãªã„è¨€èªã ã£ãŸã®ã§æ—¥ã€…è¨€èªä»•æ§˜ãªã©ã‚’å‹‰å¼·ã—ã¦ã„ã‚‹ã€‚
åŠ ãˆã¦åˆ¥ã®ç†ç”±ã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘¨ã‚Šã‚‚å‹‰å¼·ã—ã¦ãŠããŸãã€è‰¯ã„æ©Ÿä¼šãªã®ã§ã€Œè„†å¼±æ€§ã®å´é¢ã‹ã‚‰Rubyã®å‡¦ç†ç³»ã«ã¤ã„ã¦å­¦ã¶ã€ã¨ã„ã†æš´æŒ™ã«å‡ºãŸã„ã¨æ€ã†ã€‚

# Rubyã«ã¤ã„ã¦

# è„†å¼±æ€§

# CVE-2022-28739
ä»Šå›ã€èª¿æŸ»å¯¾è±¡ã«ã™ã‚‹è„†å¼±æ€§ã€‚
[å…¬å¼ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹](https://www.ruby-lang.org/ja/news/2022/04/12/buffer-overrun-in-string-to-float-cve-2022-28739/)ã«ã“ã‚“ãªæ„Ÿã˜ã§è¨˜è¼‰ãŒã‚ã‚‹ã€‚
> String ã‚’ Float ã«å¤‰æ›ã™ã‚‹å†…éƒ¨é–¢æ•°ã®ãƒã‚°ã«ã‚ˆã‚Šã€`Kernel#Float`ã‚„`String#to_f`ãªã©ã®ä¸€éƒ¨ã®å¤‰æ›ãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒãƒƒãƒ•ã‚¡ã®ã‚ªãƒ¼ãƒãƒ¼ãƒªãƒ¼ãƒ‰ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ å…¸å‹çš„ãªçµæœã¯ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚©ãƒ¼ãƒ«ãƒˆã«ã‚ˆã‚‹ãƒ—ãƒ­ã‚»ã‚¹çµ‚äº†ã§ã™ãŒã€é™ã‚‰ã‚ŒãŸçŠ¶æ³ä¸‹ã§ã¯ã€ä¸æ­£ãªãƒ¡ãƒ¢ãƒªèª­ã¿å‡ºã—ã«æ‚ªç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ã–ã£ãã‚Šè¨€ã†ã¨ã€**String â†’ Float ã«å¤‰æ›ã™ã‚‹ã¨ããƒãƒƒãƒ•ã‚¡ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒ³**ãŒç™ºç”Ÿã—ã†ã‚‹è„†å¼±æ€§ã€‚(ãã®ã¾ã¾)
[NISTã®è¨˜è¼‰](https://nvd.nist.gov/vuln/detail/CVE-2022-28739)ã‹ã‚‰è¦‹ã‚‹ã«ã€`CVSS`ã®ã‚¹ã‚³ã‚¢ã¯`7.5`ã¨æ¯”è¼ƒçš„é«˜ã‚ï¼Ÿ(`10`ãŒMaxã®ã‚ˆã†ãªã®ã§ã¾ã‚ã¾ã‚ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ã½ã„)
æ™®é€šã«ã‚»ã‚°ãƒ•ã‚©ã§çµ‚ã‚ã‚‹ã‚±ãƒ¼ã‚¹ãŒå¤šã„ã¨ã®ã“ã¨ã ãŒã€ä¸€éƒ¨ãƒ¡ãƒ¢ãƒªèª­ã¿å‡ºã—ãŒã§ãã¦ã—ã¾ã†ã‚±ãƒ¼ã‚¹ãŒã‚ã‚‹ã‚‰ã—ã„ã€‚(ã‚ã¡ã‚ƒãã¡ã‚ƒæ°—ã«ãªã‚‹)

ã‚‚ã¡ã‚ã‚“æ—¢ã«[ãƒ‘ãƒƒãƒ](https://github.com/ruby/ruby/commit/69f9992ed41920389d4185141a14f02f89a4d306)ã¯å½“ã¦ã‚‰ã‚Œã¦ã„ã¦ã€`2.6.10`/`2.7.6`/`3.0.4`/`3.1.2`ä»¥é™ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ã„ã‚Œã°å®‰å¿ƒã€‚
é€†ã«ã€ã“ã‚Œã‚‰ä»¥å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³(`2.7.5`ã¨ã‹`3.1.1`ã¨ã‹)ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯æ³¨æ„ãŒå¿…è¦ã¨ã„ã†ã“ã¨ã«ãªã‚‹ã€‚

## ãƒ‘ãƒƒãƒã‚’è¦—ã„ã¦ã¿ã‚‹
å®Ÿéš›ã«å½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹ãƒ‘ãƒƒãƒã®å†…å®¹ã‚’è¦‹ã¦ã¿ã‚‹ã€‚
å¤§ããåˆ†ã‘ã‚‹ã¨ã€æœ¬ä½“ã®ã‚³ãƒ¼ãƒ‰ã«ã¯2ã¤ã®ä¿®æ­£ãŒåŠ ãˆã‚‰ã‚Œã¦ã„ã‚‹ã€‚

ä¸€ã¤ç›®ã®å¤‰æ›´ã€‚ãƒã‚¤ãƒ³ã‚¿ã®æŒ‡ã™å…ˆãŒç„¡åŠ¹ãªå€¤ã®å ´åˆã€å¾Œå‡¦ç†ã«ã‚¸ãƒ£ãƒ³ãƒ—ã™ã‚‹åˆ†å²ã‚’è¿½åŠ ã€‚
```c
            if (!*++s || !(s1 = strchr(hexdigit, *s))) goto ret0;
            if (*s == '0') {
                while (*++s == '0');
+               if (!*s) goto ret;
                s1 = strchr(hexdigit, *s);
            }
            if (s1 != NULL) {
```

ï¼’ã¤ç›®ã®å¤‰æ›´ã€‚ãƒã‚¤ãƒ³ã‚¿ãŒæœ‰åŠ¹ã§ã‚ã‚‹å ´åˆã€ç¹°ã‚Šè¿”ã—ã‚’ç¶šã‘ã‚‹æ¡ä»¶ã‚’è¿½åŠ ã€‚
```c
                for (; *s && (s1 = strchr(hexdigit, *s)); ++s) {
                    adj += aadj * ((s1 - hexdigit) & 15);
                    if ((aadj /= 16) == 0.0) {
-                       while (strchr(hexdigit, *++s));
+                       while (*++s && strchr(hexdigit, *s));
                        break;
                    }
                }
```

è„†å¼±æ€§ã«ã¯ã¾ã ãã“ã¾ã§è©³ã—ããªã„ãŒã€å…¥åŠ›å€¤ã«ã‚ˆã£ã¦ã¯**ä½•ã‹ãŒèµ·ããã†ãªåŒ‚ã„**ã¯ãƒ—ãƒ³ãƒ—ãƒ³æ¼‚ã£ã¦ã„ã‚‹æ°—ãŒã™ã‚‹ã€‚

## è©¦ã—ã¦ã¿ã‚‹
ã¨ã‚Šã‚ãˆãšã‚„ã£ã¦ã¿ãŸã»ã†ãŒæ—©ã„ã®ã§è©¦ã—ã¦ã¿ã‚‹ã€‚

### äº‹å‰æº–å‚™
ã¾ãšã¯è©¦ã—ã¦ã¿ã‚‹ãŸã‚ã®ç’°å¢ƒã‚’ç”¨æ„ã—ã¦ã„ãã€‚
```shell
# CRubyã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦ãã‚‹
$ git clone https://github.com/ruby/ruby.git

# ãƒ‘ãƒƒãƒãŒé©ç”¨ã•ã‚Œã¦ã„ãªã„3.1.1ã«åˆ‡ã‚Šæ›¿ãˆã‚‹
$ git checkout tags/v3_1_1

### ğŸ‘‡ã“ã“ã‹ã‚‰ãƒ“ãƒ«ãƒ‰ã—ã¦ã„ã(ä¾å­˜é–¢ä¿‚ã¯ç”¨æ„ã•ã‚Œã¦ã„ã‚‹å‰æ) ###

# configureã‚’ç”Ÿæˆ
$ ./autogen.sh

# ãƒ“ãƒ«ãƒ‰ç”¨ & ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç”¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
$ mkdir build && mkdir rubies

# ãƒ“ãƒ«ãƒ‰ç”¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å…ˆã‚’æŒ‡å®šã—ã¦configureã‚’å®Ÿè¡Œ
$ cd build
$ ../configure --prefix=path/to/ruby/rubies/v3_1_1

# ä½œæˆã•ã‚ŒãŸMakefileã‚’ä½¿ã£ã¦ãƒ“ãƒ«ãƒ‰
$ make install

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç”¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«è‰²ã€…ä½œã‚‰ã‚Œã¦ã‚‹ (ä¾‹ãˆã°bin)
$ cd ../rubies/v3_1_1/bin/
$ ls
bundle  bundler  erb  gem  irb  racc  rake  rbs  rdbg  rdoc  ri  ruby  typeprof

# CRuby 3.1.1 ã®ã§ãã‚ãŒã‚Š
$ ./ruby --version
ruby 3.1.1p18 (2022-02-18 revision 53f5fc4236) [x86_64-linux]
```
(å…¨ç„¶é–¢ä¿‚ãªã„ãŒ`miniruby`ã£ã¦ã„ã†ã®ã‚‚åãå‡ºã•ã‚Œã¦ã¦ã€Œãã‚“ãªã®ã‚‚ã‚ã‚‹ã®ã‹ãƒ»ãƒ»ãƒ»ã€ã¨æ€ã£ãŸ)

### å®Ÿè¡Œã—ã¦ã¿ã‚‹
ãƒ‘ãƒƒãƒã«å«ã¾ã‚Œã¦ã„ã‚‹[ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰](https://github.com/ruby/ruby/blob/8d142ecff9af7d60728b8cfa9138e8623985c428/test/ruby/test_float.rb#L175)ã‚’è¦‹ãªãŒã‚‰è©¦ã—ã«å®Ÿè¡Œã—ã¦ã¿ã‚‹ã€‚

é©å½“ã«`/tmp`ã¨ã‹ã«ä»¥ä¸‹ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œã£ã¦ã€
```ruby
def valid_value
  2000.times do
    f = Float('0x000000000')
  end
end

def invalid_value
  2000.times do
    f = Float('0x' + ('0' * 30))
  end
end

valid_value
invalid_value
```

ãƒ“ãƒ«ãƒ‰ã—ãŸ`3.1.1`ã§å®Ÿè¡Œã€‚
```shell
$ ./ruby --version
ruby 3.1.1p18 (2022-02-18 revision 53f5fc4236) [x86_64-linux]

$ ./ruby /tmp/test.rb
<internal:kernel>:173:in `Float': invalid value for Float(): "0x000000000000000000000000000000" (ArgumentError)
	from /tmp/test.rb:9:in `block in invalid_value'
	from /tmp/test.rb:8:in `times'
	from /tmp/test.rb:8:in `invalid_value'
	from /tmp/test.rb:17:in `<main>'
```
ãŸã—ã‹ã«ãªã‚“ã‹èµ·ããŸã€‚
è©¦ã—ã«`3.1.2`ã§å®Ÿè¡Œã—ã¦ã¿ã¦ã‚‚å•é¡Œãªãå‹•ãã®ãŒã‚ã‹ã‚‹ã€‚
```shell
$ ruby --version
ruby 3.1.2p20 (2022-04-12 revision 4491bb740a) [x86_64-linux]

$ ruby /tmp/test.rb
```

2000å›ãƒ«ãƒ¼ãƒ—ã—ã¦ã‚‹ã¨ã“ã‚ãªã‚“ã ãŒã€è©¦ã—ã«å˜ç™ºã§è©¦ã—ã¦ã¿ã‚‹ã¨ä½•äº‹ã‚‚èµ·ããšã«æ­£å¸¸çµ‚äº†ã™ã‚‹ã“ã¨ã‚‚ã‚ã‚‹ã¿ãŸã„ã§ã€2000å›ãã‚‰ã„ãƒ«ãƒ¼ãƒ—ã™ã‚Œã°ç¢ºå®Ÿã«ç•°å¸¸ã‚±ãƒ¼ã‚¹è¸ã‚€ã¿ãŸã„ã€‚

## ä½•ãŒèµ·ãã¦ã„ã‚‹ã®ã‹ï¼Ÿ
ãŸã—ã‹ã«ã€å®Ÿéš›ã«ä¸æ€è­°ãªæŒ™å‹•ãŒèµ·ãã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã£ãŸã®ã§ã€ãƒ‘ãƒƒãƒãŒã‚ãŸã£ã¦ã„ã‚‹å‡¦ç†ã‚’ã‚’ã‚‚ã†å°‘ã—æ·±ãè¦‹ã¦ã„ãã€‚

è©²å½“ã®ãƒ‘ãƒƒãƒãŒã‚ãŸã£ã¦ã„ã‚‹ã®ã¯`strtod`ã¨ã„ã†é–¢æ•°ã€‚
```c
double
strtod(const char *s00, char **se)
{
    ...
    for (s = s00;;s++)
        switch (*s) {
          case '-':
            sign = 1;
            /* no break */
          case '+':
            if (*++s)
                goto break2;
            /* no break */
          case 0:
            goto ret0;
          case '\t':
          ... (ã“ã®è¾ºã¯ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹å¯¾è±¡ã‚’åˆ—æŒ™ã—ã¦ã„ã‚‹ã®ã§çœç•¥)
          case ' ':
            continue;
          default:
            goto break2;
        }
break2:
    if (*s == '0') {
        if (s[1] == 'x' || s[1] == 'X') {
            s0 = ++s;
            adj = 0;
            aadj = 1.0;
            nd0 = -4;

            if (!*++s || !(s1 = strchr(hexdigit, *s))) goto ret0;
            if (*s == '0') {
                while (*++s == '0');
                if (!*s) goto ret;  // ã“ã“ãŒãƒ‘ãƒƒãƒã®ã¨ã“ã‚â‘ 
                s1 = strchr(hexdigit, *s);
            }
    ...
```
è¦‹ãŸã¨ã“ã‚ã€å‰åŠéƒ¨ã§ã€Œç¬¦å·ã®æœ‰ã‚Šç„¡ã—ã‚’åˆ¤å®šã€ã—ãŸã‚Šã€Œã‚¿ãƒ–æ–‡å­—ã‚„ã‚‰ã‚’ã‚¹ã‚­ãƒƒãƒ—ã€ã—ãŸã‚Šã—ã¦ã„ã‚‹ã€‚
ãã®å¾Œ`0x`ã‚„`0X`ã§å§‹ã¾ã‚‹æ–‡å­—åˆ—ã®å ´åˆã€å¯¾è±¡ã®ãƒ‘ãƒƒãƒãŒã‚ãŸã£ã¦ã„ã‚‹ç®‡æ‰€ã«çªå…¥ã—ã¦ã„ã£ã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚‹ã€‚
`0x`ã‚‚ã—ãã¯`0X`ã®ç›´å¾Œã‹ã‚‰`0 (0x30)`ãŒç¶šãé–“ã¯ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ãŠã‚Šã€ãã‚Œä»¥å¤–ã§ã‚ã‚Œã°16é€²æ•°ã®æ•°å€¤ã‚’`strchr`ã§æ¢ã—ã¦ã„ã‚‹ã€‚

ã‚‚ã†ä¸€ç®‡æ‰€ã¯å°æ•°ç‚¹ã‚’å«ã‚€å ´åˆã€‚
```c
    ...
        if (*s == '0') {
            while (*++s == '0');
            if (!*s) goto ret;  // ã“ã“ãŒãƒ‘ãƒƒãƒã®ã¨ã“ã‚â‘ 
            s1 = strchr(hexdigit, *s);
        }
        if (s1 != NULL) {
            do {
                adj += aadj * ((s1 - hexdigit) & 15);
                nd0 += 4;
                aadj /= 16;
            } while (*++s && (s1 = strchr(hexdigit, *s)));
        }

        if (*s == '.') {
            dsign = 1;
            if (!*++s || !(s1 = strchr(hexdigit, *s))) goto ret0;
            if (nd0 < 0) {
                while (*s == '0') {
                    s++;
                    nd0 -= 4;
                }
            }
            for (; *s && (s1 = strchr(hexdigit, *s)); ++s) {
                adj += aadj * ((s1 - hexdigit) & 15);
                if ((aadj /= 16) == 0.0) {
                    while (*++s && strchr(hexdigit, *s));  // ã“ã“ãŒãƒ‘ãƒƒãƒã®ã¨ã“ã‚â‘¡
                    break;
                }
    ...
```

ãªã‚“ã‹è‰²ã€…ã‚„ã£ã¦ã„ã‚‹ã¿ãŸã„ã ãŒã€ã©ã‚“ãªçŠ¶æ³ã§ã“ã®é–¢æ•°ãŒå‘¼ã°ã‚Œã¦ã„ã‚‹ã®ã‹ãªã©ã‚ã‹ã‚‰ãªã„ã¨ã‚ˆãã‚ã‹ã‚‰ãªã„ã®ã§å‹•ã‹ã—ãªãŒã‚‰ãƒ‡ãƒãƒƒã‚°ã—ã¦ã¿ã‚‹ã€‚(ã¤ã„ã§ã«Rubyã®å‡¦ç†ç³»ã«ã¤ã„ã¦ã‚‚å‹‰å¼·ã«ãªã‚‰ãªã„ã¨ä¼ç”»å€’ã‚Œã«ãªã£ã¦ã—ã¾ã†ã®ã§)

### ãƒ‡ãƒãƒƒã‚°ã—ã¦ã¿ã‚‹
ãƒ‡ãƒãƒƒã‚°ç”¨ã«ãƒ“ãƒ«ãƒ‰ã—ã¦ã€ã•ã£ãã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã‚‹ã€‚
```shell
# ãƒ“ãƒ«ãƒ‰ç”¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
$ cd path/to/ruby/build

# ãƒ‡ãƒãƒƒã‚°ç”¨ã«configure
$ ../configure optflags="-O0" --prefix="path/to/ruby/rubies/v3_1_1"

# ãƒ“ãƒ«ãƒ‰
$ make install
```

gdbã§ã‚„ã£ã¦ã„ãã€‚
```shell
$ gdb -q --args ./ruby /tmp/test.rb
Reading symbols from ./ruby...

# ã¨ã‚Šã‚ãˆãš`missing/dtoa.c`ã®`1553`è¡Œç›®ã«ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’ãŠã„ã¦ã¿ã‚‹
(gdb) break missing/dtoa.c:1553
Breakpoint 1 at 0x2024ba: file ../missing/dtoa.c, line 1553.

# ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã¾ã§é€²ã‚ã‚‹ (ruby_strtodã§æ­¢ã¾ã£ã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚‹)
(gdb) run
Starting program: /home/kate/src/ruby/rubies/v3_1_1/bin/ruby /tmp/test.rb
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".

Breakpoint 1, ruby_strtod (s00=0x7ffff3717038 "0x000000", se=0x7fffffffd3c8) at ../missing/dtoa.c:1553
1553		    if (!*++s || !(s1 = strchr(hexdigit, *s))) goto ret0;

# backtraceã§ã“ã“ã¾ã§ã®é“ã®ã‚Šã‚’å‡ºåŠ›ã—ã¦ã¿ã‚‹
(gdb) backtrace
#0  ruby_strtod (s00=0x7ffff3717038 "0x000000", se=0x7fffffffd3c8) at ../missing/dtoa.c:1553
#1  0x0000555555648875 in rb_cstr_to_dbl_raise (p=p@entry=0x7ffff3717038 "0x000000", badcheck=badcheck@entry=1, raise=raise@entry=1, error=error@entry=0x0) at ../object.c:3276
#2  0x0000555555648e8d in rb_cstr_to_dbl_raise (error=0x0, raise=1, badcheck=1, p=0x7ffff3717038 "0x000000") at ../object.c:3268
#3  rb_str_to_dbl_raise (str=<optimized out>, badcheck=badcheck@entry=1, raise=raise@entry=1, error=error@entry=0x0) at ../object.c:3404
#4  0x000055555564e070 in rb_str_to_dbl (str=<optimized out>, badcheck=badcheck@entry=1) at ../object.c:3415
#5  0x000055555564e6ed in rb_convert_to_float (raise_exception=1, val=<optimized out>) at ../object.c:3510
#6  rb_f_float1 (ec=<optimized out>, obj=<optimized out>, arg=<optimized out>) at ../object.c:3537
#7  0x000055555578c2b9 in invoke_bf (argv=<optimized out>, bf=<optimized out>, reg_cfp=<optimized out>, ec=<optimized out>) at ../vm_insnhelper.c:5909
#8  vm_invoke_builtin_delegate (start_index=<optimized out>, bf=<optimized out>, cfp=<optimized out>, ec=<optimized out>) at ../vm_insnhelper.c:5936
#9  vm_exec_core (ec=0x7ffff3717038, initial=140737488344008) at ../insns.def:1498
#10 0x000055555577c31f in rb_vm_exec (ec=0x5555559b59b0, mjit_enable_p=true) at ../vm.c:2211
#11 0x00005555557800e8 in invoke_block (captured=<optimized out>, captured=<optimized out>, opt_pc=<optimized out>, type=<optimized out>, cref=0x0, self=140737333150440, iseq=0x7ffff37100e8, ec=0x5555559b59b0)
    at ../vm.c:1316
#12 invoke_iseq_block_from_c (me=0x0, is_lambda=<optimized out>, cref=0x0, passed_block_handler=0, kw_splat=0, argv=0x7fffffffd748, argc=1, self=140737333150440, captured=<optimized out>, ec=0x5555559b59b0)
    at ../vm.c:1372
#13 invoke_block_from_c_bh (force_blockarg=<optimized out>, is_lambda=<optimized out>, cref=<optimized out>, passed_block_handler=<optimized out>, kw_splat=<optimized out>, argv=<optimized out>, 
    argc=<optimized out>, block_handler=<optimized out>, ec=<optimized out>) at ../vm.c:1390
#14 vm_yield_with_cref (is_lambda=0, cref=0x0, kw_splat=0, argv=0x7fffffffd748, argc=1, ec=0x5555559b59b0) at ../vm.c:1427
#15 vm_yield (kw_splat=0, argv=0x7fffffffd748, argc=1, ec=0x5555559b59b0) at ../vm.c:1435
#16 rb_yield_0 (argv=0x7fffffffd748, argc=1) at ../vm_eval.c:1347
#17 rb_yield_1 (val=<optimized out>, val@entry=1) at ../vm_eval.c:1353
#18 0x000055555563ff1c in int_dotimes (num=4001) at ../numeric.c:5701
#19 0x000055555576fc97 in vm_call_cfunc_with_frame (ec=0x5555559b59b0, reg_cfp=0x7ffff6d53f50, calling=<optimized out>) at ../vm_insnhelper.c:3037
#20 0x0000555555773ff5 in vm_sendish (ec=0x5555559b59b0, reg_cfp=0x7ffff6d53f50, cd=0x555555aff970, block_handler=<optimized out>, method_explorer=mexp_search_method) at ../vm_callinfo.h:349
#21 0x000055555578ac42 in vm_exec_core (ec=0x7ffff3717038, initial=140737488344008) at ../insns.def:759
#22 0x000055555577c31f in rb_vm_exec (ec=0x5555559b59b0, mjit_enable_p=true) at ../vm.c:2211
#23 0x0000555555583c11 in rb_ec_exec_node (ec=ec@entry=0x5555559b59b0, n=n@entry=0x7ffff3710408) at ../eval.c:280
#24 0x0000555555588d7d in ruby_run_node (n=0x7ffff3710408) at ../eval.c:321
#25 0x000055555558399f in main (argc=<optimized out>, argv=<optimized out>) at ../main.c:47
```

`backtrace`ã®å‡ºåŠ›ã®ä¸€ç•ªä¸‹ã‹ã‚‰è¾¿ã£ã¦ã¿ã‚‹ã¨ã€ã“ã‚“ãªæ„Ÿã˜ã§è¾¿ã£ã¦ãã¦ã„ã‚‹ã‚‰ã—ã„ã€‚
- main
- ruby_run_code
- rb_ec_exec_node
- rb_vm_exec
- ... (ãŸã¶ã‚“`2000.times`ã¨ã‹å‘¼ã‚“ã§ã‚‹ç®‡æ‰€ã§æœ¬ç­‹ã¨ã¯é–¢ä¿‚ãªã„ã®ã§çœç•¥)
- vm_exec_core
- vm_invoke_builtin_delegate
- invoke_bf
- rb_f_float1
- rb_convert_to_float
- rb_str_to_dbl
- rb_str_to_dbl_raise
- rb_cstr_to_dbl_raise
- ruby_strtod

# æœ€å¾Œã«
