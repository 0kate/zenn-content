---
title: "Ruby 3.2.0のWasmサポートを試してみた"
emoji: "🤖"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["ruby", "webassembly"]
published: false
---

# Ruby 3.2.0のWasmサポートを試してみた
Ruby 3.2.0でWASIベースのWasmバイナリへのコンパイルがサポートされたということで、試してみました。
https://www.ruby-lang.org/ja/news/2022/12/25/ruby-3-2-0-released/

# WASIベースのWasmに対応ってどういうこと？
CRubyが、従来のネイティブバイナリへのコンパイルに加え、Wasmにもコンパイルできるようになったようです。
WasmにコンパイルできるようになりWebブラウザ上でもCRubyを動かせるのに加え、WASIにも対応しているので`Wasmer`などのランタイムを用いればホスト上でも実行できるようになります。

# 使ってみる
とりあえず使ってみる。

## 事前準備
CRubyをWasmバイナリにビルドするためにはいくつか事前準備が必要です。
[WASIベースのWasm対応が追加されたPR](https://github.com/ruby/ruby/pull/5407)を参考に準備していきます。

### Ruby
クローンしてきます。

### GNU Make
なければインストールしてきます。

### WASI SDK
C/C++から、WASIベースのWasmをビルドするために必要なものをgitsubmoduleとして集約したものです。
実際にビルドするコンパイラとしてのClang/LLVMや、ビルドする際に必要なライブラリとしての`wasi-libc`などが含まれます。
バージョンは14.0以降が必要です。
リポジトリをクローンしてきてビルドしても良いですし、releasesページからビルド済みのものを落としてきても良いです。

### Binaryen
Wasmにコンパイルするためのコンパイラです。中間表現Binaryen IRを内部で用いてコンパイルします。
パージョン91以降が必要です。

## ビルドする

## 実行してみる

# wasi-vfs
Unix系のシステムでもVFSというものが出てきますが、まさにそれに近しい概念です。
抽象的なインターフェースの仕様の話であるため、実態はありません。
この仕様に従うように実装されていれば、その先の処理が何であろうと上位層のコンポーネントから操作可能になるものです。

`wasi-vfs`はWasm向けに定義されたVFSです。
